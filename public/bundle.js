(()=>{"use strict";const t=document.querySelector.bind(document),e=document.querySelectorAll.bind(document),o=(t,e,o)=>null==t?void 0:t.addEventListener(e,o),n=(t,e)=>{t&&(t.innerHTML=e)},r=(t,e)=>{if(t)for(const o in e)t.style[o]=e[o]},a=(t,e)=>{if(t)for(let o of e.split(" "))return t.classList.contains(o)},s=(t,e,o="add")=>{t&&e.split(" ").forEach((e=>{t.classList[o](e)}))},l=t=>t.getBoundingClientRect(),c=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,i="container",d=["#de8f6f","#3c7cab"],h="ARCHERY_MASTER_JORGE",p=()=>{const t=window.localStorage.getItem(h)||"";return""!==t&&(t=>{try{return JSON.parse(t),!0}catch(t){return!1}})(t)?JSON.parse(t):{}},f=(t,e)=>{const o=p();o[t]=e,(t=>{const e=JSON.stringify(t);window.localStorage.setItem(h,e)})(o)},u=(t="",e)=>p()[t]||e;let b,v,w;v=.3,b=(t=1,e=.05,o=220,n=0,r=0,a=.1,s=0,l=1,c=0,i=0,d=0,h=0,p=0,f=0,u=0,b=0,v=0,$=1,g=0,y=0,m=Math,x=44100,M=2*m.PI,E=(c*=500*M/x/x),I=(o*=(1-e+2*e*m.random(e=[]))*M/x),k=0,j=0,A=0,S=1,L=0,R=0,O=0,B,C)=>{for(n=x*n+9,g*=x,r*=x,a*=x,v*=x,i*=500*M/Math.pow(x,3),u*=M/x,d*=M/x,h*=x,p=x*p|0,C=n+g+r+a+v|0;A<C;e[A++]=O)++R%(100*b|0)||(O=s?1<s?2<s?3<s?m.sin(Math.pow(k%M,3)):m.max(m.min(m.tan(k),1),-1):1-(2*k/M%2+2)%2:1-4*m.abs(m.round(k/M)-k/M):m.sin(k),O=(p?1-y+y*m.sin(M*A/p):1)*(0<O?1:-1)*Math.pow(m.abs(O),l)*.3*t*(A<n?A/n:A<n+g?1-(A-n)/g*(1-$):A<n+g+r?$:A<C-v?(C-A-v)/a*$:0),O=v?O/2+(v>A?0:(A<C-v?1:(C-A)/v)*e[A-v|0]/2):O),k+=(B=(o+=c+=i)*m.cos(u*j++))-B*f*(1-1e9*(m.sin(A)+1)%2),S&&++S>h&&(o+=d,I+=d,S=0),!p||++L%p||(o=I,c=E,S||(S=1));return(t=w.createBuffer(1,C,x)).getChannelData(0).set(e),(o=w.createBufferSource()).buffer=t,o.connect(w.destination),o.start(),o},w=new AudioContext;let $="yes"===u("sound","yes");const g={gameOver:[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07],shot:[,,150,.05,,.05,,1.3,,,,,,3],counter:[,.1,75,.03,.08,.17,1,1.88,7.83,,,,,.4],click:[,,537,.02,.02,.22,1,1.59,-6.98,4.97],target:[1.03,,754,.03,.02,.09,,1.58,36.1,-14,,.01,-.01,.7,,,,.44,.03]},y=t=>{$&&b(...g[t])},m=({id:t,left:e,top:o,rotation:n,scale:r})=>`<div\n  id="${t}"\n  class="arrow"\n  style="transform:rotate(${n}deg);left:${e}px;top:${o}px;"\n>\n  <svg viewBox="0 0 85 470" style="transform:scaleY(${r});">\n    <polygon\n      fill="#E6E9ED"\n      points="85.32601928710938,127.98799896240234 51.201019287109375,149.33100128173828 33.516021728515625,149.33100128173828 0,127.98799896240234 0,21.334999084472656 85.32601928710938,21.334999084472656 "\n    />\n    <path\n      fill="#FFCE54"\n      d="m50.20101,3.117c-4.155,-4.156 -10.921,-4.156 -15.077,0c-2.093,2.094 -3.124,4.812 -3.124,7.547l0,0l0,394.283l21.326,0l0,-394.252c0.016,-2.734 -1.031,-5.484 -3.125,-7.578z"\n    />\n    <path\n      fill="#ED5564"\n      d="m55.37301,390.666c-4.484,0 -8.812,1.031 -12.718,2.984c-3.891,-1.953 -8.219,-2.984 -12.702,-2.984c-15.703,0 -28.469,12.766 -28.469,28.469c0,25.717 32.141,45.217 35.812,47.357l5.375,3.125l5.375,-3.125c3.655,-2.141 35.796,-21.641 35.796,-47.357c0,-15.688 -12.766,-28.469 -28.469,-28.469z"\n    />\n  </svg>\n</div>`,x=({id:t,fill:e,left:o,top:n,rotation:r,scale:a})=>`<div\n  id="${t}"\n  class="bow"\n  style="transform:rotate(${r}deg);left:${o}px;top:${n}px"\n>\n  <svg viewBox="0 0 190 491" style="transform:scaleX(${a});">\n    <rect x="12" fill="black" width="21" height="500"/>\n    <path\n      fill="${e}"\n      d="m170.75487,205.321c0,0 20.5,-29.858 19.406,-52.482c-4,-83.169 -107.668,-88.497 -159.557,-152.839l-30.515,0c-4.156,64.467 138.823,93.419 141.964,146.448c1.438,24.421 -13.984,53.857 -13.984,53.857l0,90.028c0,0 15.421,29.437 13.984,53.857c-3.141,53.029 -146.12,81.982 -141.964,146.449l30.515,0c51.889,-64.342 155.557,-69.67 159.557,-152.84c1.094,-22.623 -19.406,-52.482 -19.406,-52.482l0,-79.996z"\n    />\n  </svg>\n</div>`,M=({index:t,type:e})=>`<div class="case ${e}">\n  ${m({id:`ac-${t}-1`,left:5,top:-50,rotation:-10,scale:1})}\n  ${m({id:`ac-${t}-2`,left:17,top:-50,rotation:0,scale:1})}\n  ${m({id:`ac-${t}-3`,left:29,top:-50,rotation:10,scale:1})}\n  </div>`,E=[{w:140,h:245,p:[[54,0],[36,35],[71,35],[18,70],[53,70],[88,70],[0,105],[35,105],[70,105],[105,105],[18,140],[53,140],[88,140],[36,175],[71,175],[54,210]]},{w:105,h:105,p:[[35,0],[35,35],[35,70],[0,35],[70,35]]},{w:175,h:175,a:!0,p:[[155,68],[145,108],[117,140],[78,154],[36,149],[2,126],[-17,88],[-17,47],[2,9],[36,-14],[78,-19],[117,-5],[145,27]]},{w:175,h:175,p:[[70,0],[35,35],[105,35],[0,70],[70,70],[140,70],[35,105],[105,105],[70,140]]},{w:140,h:140,a:!0,p:[[0,0],[35,0],[70,0],[105,0],[0,35],[105,35],[0,70],[105,70],[0,105],[35,105],[70,105],[105,105]]},{w:35,h:105,p:[[0,0],[0,35],[0,70]]},{w:175,h:175,a:!0,p:[[0,70],[35,70],[70,70],[105,70],[140,70],[70,0],[70,35],[70,105],[70,140]]},{w:105,h:105,p:[[35,35],[0,35],[70,35],[35,0],[35,70]]}],I=(e=0)=>{const{w:o,h:n,p:r,a=!1}=E[e],s=a||1===c(0,1);let l="";if(s){const t=c(0,1);l=`--s:${c(2,5)}s;--i:${t?"0":"359"}deg;--f:${t?"359":"0"}deg;`}return t("html").style.cssText=l,`<div class="targets${s?" a":""}" style="width:${o}px;height:${n}px;">\n  ${r.map((([t,e],o)=>((t="",e=0,o=0)=>`<div class="target" id=${t} style="left:${e}px;top:${o}px"></div>`)(`t-${o}`,t,e))).join("")}\n  </div>`};let k,j=0,A=!1;const S="hide";let L=!1;const R=[{animate:!1,angle:0,point:{x:0,y:0},score:0,arrows:0,hasArrow:!0},{animate:!1,angle:0,point:{x:0,y:0},score:0,arrows:0,hasArrow:!0}],O=[{bow:{fill:d[0],left:176,top:542,rotation:270,scale:1},arrow:{left:195,top:572,rotation:0,scale:-1}},{bow:{fill:d[1],left:176,top:40,rotation:270,scale:-1},arrow:{left:195,top:75,rotation:0,scale:1}}],B=(t,e)=>{const o=l(e),n=l(t);return{top:Math.round(o.top-n.top),left:Math.round(o.left-n.left)}},C=(t=0)=>{let e=t%360;return e<0&&(e+=360),Math.round(Math.abs(e))},D=(t,e)=>180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI,J=e=>{const{left:o,top:n}=l(t("#control"));let r=0,a=0;e instanceof MouseEvent?(r=e.clientX,a=e.clientY):e instanceof TouchEvent&&(r=e.touches[0].clientX,a=e.touches[0].clientY);return{x:Math.round(r-o),y:Math.round(a-n)}},T=e=>{const o=t("#bow-1"),{left:n,top:a}=B(t("#control"),o),{width:s}=l(o),c={x:Math.round(n+s/2),y:a},i=D(c,e),d=C(i);if(d>=180&&d<=360){r(o,{transform:`rotate(${d}deg)`});const e=d-270;R[0].angle=e,r(t("#arrow-1"),{transform:`rotate(${e}deg)`})}},Y=()=>n(t(".score"),`<span>${R[0].score}</span> - <span>${R[1].score}</span>`),N=()=>[...e(".target")].filter((t=>!a(t,S))),z=(t,e)=>t.x>=e.start.x&&t.y>=e.start.y&&t.x<=e.end.x&&t.y<=e.end.y,H=(e,o)=>{const n=t(`#arrow-${e}`),{angle:r}=R[e-1],{x:a,y:s}=((t,e,o)=>{const n=l(e),r=n.width,a=n.height,s=t*(1===o?1:-1)*Math.PI/180;return{x:n.left+r/2+a/2*Math.sin(s),y:n.top+(2===o?a-20:0)+a/2-a/2*Math.cos(s)}})(r,n,e),c=l(o),i={start:{x:Math.round(c.x),y:Math.round(c.y)},end:{x:Math.round(c.x+c.width),y:Math.round(c.y+c.height)}};return z({x:a-3,y:s},i)||z({x:a,y:s},i)||z({x:a+3,y:s},i)},P=(e=1)=>{const o=t(`#arrow-${e}`),{angle:l,point:c}=R[e-1],i=(l-90)*(Math.PI/180),d=c.x+15*Math.cos(i)*(1===e?1:-1),h=c.y+15*Math.sin(i)*(1===e?1:-1);if(R[e-1].point={x:d,y:h},r(o,{left:`${d}px`,top:`${h}px`}),p=d,(b=h)<-100||p<-50||b>832||p>462){R[e-1].animate=!1,clearInterval(R[e-1].interval);const a=R[e-1].arrows>0;if(R[e-1].hasArrow=a,a){const{left:n,top:a}=O[e-1].arrow;r(o,{left:`${n}px`,top:`${a}px`}),s(t(`#ac-${e}-${R[e-1].arrows}`),S,"add"),R[e-1].arrows--,2===e&&U()}else r(t(`#bow-${e}`),{transform:`rotate(${O[e-1].bow.rotation}deg)`});(()=>{const e=R.findIndex((t=>t.score>=70));if(e>=0){F(),L=!0;const o=t(".win-ui"),r=0===e?"r":"b";n(o,`<span>${0===e?"RED":"BLUE"} WIN</span>`),s(o,S,"remove"),s(o,r,"add"),y("gameOver");const a=u("score",{red:0,blue:0});a[0===e?"red":"blue"]++,f("score",a)}else{const t=N(),e=0!==R.filter((t=>t.hasArrow)).length;(0===t.length||!e)&&(F(),W())}})()}else(t=>{const e=N();for(const o of e){const e=o;H(t,e)&&!a(e,S)&&(s(e,S,"add"),R[t-1].score++,Y(),y("target"))}})(e);var p,b},X=(t=1)=>{const{left:e,top:o}=O[t-1].arrow;R[t-1].point={x:e,y:o},R[t-1].animate=!0,R[t-1].interval=setInterval((()=>P(t)),1),y("shot")},_=t=>{L||A||R[0].animate||!R[0].hasArrow||(T(J(t)),A=!0)},G=()=>{L||!A||R[0].animate||(X(),A=!1)},q=t=>{L||!A||R[0].animate||T(J(t))},F=()=>{k&&clearInterval(k);for(let t=0;t<R.length;t++)R[t].interval&&clearInterval(R[t].interval)},U=()=>{let e=N();const o=[18,10,2][j-1];if(L||0===e.length)return;let n=c(0,e.length-1),s=e[n];const l={x:O[1].bow.left,y:O[1].bow.top};let i=0;k=setInterval((()=>{L&&clearInterval(k);const{left:d,top:h}=B(t(".game"),s),p=C(D(l,{x:d,y:h}));r(t("#bow-2"),{transform:`rotate(${p}deg)`});const f=p-270;if(R[1].angle=f,r(t("#arrow-2"),{transform:`rotate(${f}deg)`}),i++,i%o==0){let t=!0;a(s,S)&&(e=N(),0!==e.length&&(n=c(0,e.length-1),s=e[n],t=!1)),t&&(clearInterval(k),X(2))}}),100)},W=()=>{const e=c(0,E.length-1);n(t("#r-target"),I(e)),O.forEach((({arrow:e,bow:o},n)=>{r(t(`#bow-${n+1}`),{transform:`rotate(${o.rotation}deg)`}),r(t(`#arrow-${n+1}`),{left:`${e.left}px`,top:`${e.top}px`,transform:`rotate(${e.rotation}deg)`,display:"block"})}));for(let e=0;e<R.length;e++){R[e].animate=!1,R[e].arrows=2,R[e].hasArrow=!0,R[e].interval&&clearInterval(R[e].interval);for(let o=1;o<=3;o++)s(t(`#ac-${e+1}-${o}`),S,3===o?"add":"remove")}U()},K=({color:t,score:e,type:o})=>`<div class="pe"><svg viewBox="0 0 24 24">\n    <path fill=${t} d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418 4.72-8.912 1.251-13.678-3.732-13.678-5.082 0-8.464 4.949-3.732 13.678 1.597 2.945-1.725 3.641-5.09 4.418-3.073.71-3.188 2.236-3.178 4.904l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z"/>\n  </svg>\n  <div id="sc-${o}"  class="pe-sco">${e}</div>\n  </div>`,Q={Game:({dificulty:e=1})=>{const r=`<div class="game wh jc">\n      <div class="lock-ui wh jc"></div>\n      <div class="win-ui hide wh jc"></div>\n      ${O.map(((t,e)=>`${x(Object.assign({id:`bow-${e+1}`},t.bow))}\n          ${m(Object.assign({id:`arrow-${e+1}`},t.arrow))}\n          ${M({index:e+1,type:0===e?"bottom":"top"})}\n        `)).join("")}\n      <div class="score jc"></div>\n      <button id="exit">EXIT</button>\n      <div id="r-target"></div>\n      <div id="control"></div>\n  </div>`;n(t(`#${i}`),r),(e=>{j=e,[["mousedown",_],["mouseup",G],["mousemove",q],["touchstart",_],["touchend",G],["touchmove",q],["mouseleave",G]].forEach((e=>o(t("#control"),e[0],e[1]))),o(t("#exit"),"click",(()=>{F(),V("Lobby")})),L=!1;for(let t=0;t<R.length;t++)R[t].score=0;Y();let r=3;const a=setInterval((()=>{n(t(".lock-ui"),String(r)),y("counter"),r--,r<0&&(s(t(".lock-ui"),S,"add"),clearInterval(a),W())}),1e3)})(e)},Lobby:()=>{const r=`<div class="lobby wh">\n  <button class="lobby-so jc">${$?"🔈":"🔇"}</button>\n  <a title="Jorge Rubiano" href="https://bio.link/jorgerub" target="_blank" rel="noopener noreferrer" class="lobby-ab jc">👨🏻‍💻</a>\n  <h1>ARCHERY MASTER</h1>\n  <div class="lobby-btn jc">\n      <p>\n        Load your bow and hit 70 targets before your opponent!\n      </p>\n      <div class="jc">\n        <button>EASY</button>\n        <button>MEDIUM</button>\n        <button>HARD</button>\n      </div>\n    </div>\n    <div class="lobby-pe">\n      ${K({color:d[0],score:0,type:"red"})}\n      ${K({color:d[1],score:0,type:"blue"})}\n    </div>\n    <a href="https://js13kgames.com/" target="_blank" rel="noopener noreferrer" class="lobby-co">JS13k - 2023</a>\n  </div>`;n(t(`#${i}`),r),[...e(".lobby-btn button")].forEach(((t,e)=>{o(t,"click",(()=>{V("Game",{dificulty:e+1})}))})),o(t(".lobby-so"),"click",(()=>{var e;e=t(".lobby-so"),$=!$,f("sound",$?"yes":"no"),n(e,$?"🔈":"🔇")}));const a=u("score",{red:0,blue:0});n(t("#sc-red"),a.red),n(t("#sc-blue"),a.blue)}},V=(t="Lobby",e={})=>{Q[t](e)};n(t("#root"),`<div\n    id="${i}"\n    style="overflow: hidden;width:412px;height:732px"\n  ></div>`),o(document,"contextmenu",(t=>t.preventDefault()));o(window,"click",(t=>{const e=t.target;e&&["a","button"].includes(e.tagName.toLowerCase())&&y("click")})),V("Lobby")})();