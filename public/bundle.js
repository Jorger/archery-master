(()=>{"use strict";const t=document.querySelector.bind(document),o=document.querySelectorAll.bind(document),e=(t,o,e)=>null==t?void 0:t.addEventListener(o,e),n=(t,o)=>{t&&(t.innerHTML=o)},a=(t,o)=>{if(t)for(const e in o)t.style[e]=o[e]},r=(t,o)=>{if(t)for(let e of o.split(" "))return t.classList.contains(e)},l=(t,o,e="add")=>{t&&o.split(" ").forEach((o=>{t.classList[e](o)}))},s=t=>t.getBoundingClientRect(),i=(t,o)=>Math.floor(Math.random()*(o-t+1))+t,c="container",d=({id:t,left:o,top:e,rotation:n,scale:a})=>`<div\n  id="${t}"\n  class="arrow"\n  style="transform:rotate(${n}deg);left:${o}px;top:${e}px;"\n>\n  <svg viewBox="0 0 85 470" style="transform:scaleY(${a});">\n    <polygon\n      fill="#E6E9ED"\n      points="85.32601928710938,127.98799896240234 51.201019287109375,149.33100128173828 33.516021728515625,149.33100128173828 0,127.98799896240234 0,21.334999084472656 85.32601928710938,21.334999084472656 "\n    />\n    <path\n      fill="#FFCE54"\n      d="m50.20101,3.117c-4.155,-4.156 -10.921,-4.156 -15.077,0c-2.093,2.094 -3.124,4.812 -3.124,7.547l0,0l0,394.283l21.326,0l0,-394.252c0.016,-2.734 -1.031,-5.484 -3.125,-7.578z"\n    />\n    <path\n      fill="#ED5564"\n      d="m55.37301,390.666c-4.484,0 -8.812,1.031 -12.718,2.984c-3.891,-1.953 -8.219,-2.984 -12.702,-2.984c-15.703,0 -28.469,12.766 -28.469,28.469c0,25.717 32.141,45.217 35.812,47.357l5.375,3.125l5.375,-3.125c3.655,-2.141 35.796,-21.641 35.796,-47.357c0,-15.688 -12.766,-28.469 -28.469,-28.469z"\n    />\n  </svg>\n</div>`,h=({id:t,fill:o,left:e,top:n,rotation:a,scale:r})=>`<div\n  id="${t}"\n  class="bow"\n  style="transform:rotate(${a}deg);left:${e}px;top:${n}px"\n>\n  <svg viewBox="0 0 190 491" style="transform:scaleX(${r});">\n    <rect x="12" fill="black" width="21" height="500"/>\n    <path\n      fill="${o}"\n      d="m170.75487,205.321c0,0 20.5,-29.858 19.406,-52.482c-4,-83.169 -107.668,-88.497 -159.557,-152.839l-30.515,0c-4.156,64.467 138.823,93.419 141.964,146.448c1.438,24.421 -13.984,53.857 -13.984,53.857l0,90.028c0,0 15.421,29.437 13.984,53.857c-3.141,53.029 -146.12,81.982 -141.964,146.449l30.515,0c51.889,-64.342 155.557,-69.67 159.557,-152.84c1.094,-22.623 -19.406,-52.482 -19.406,-52.482l0,-79.996z"\n    />\n  </svg>\n</div>`,p=({index:t,type:o})=>`<div class="case ${o}">\n  ${d({id:`ac-${t}-1`,left:5,top:-50,rotation:-10,scale:1})}\n  ${d({id:`ac-${t}-2`,left:17,top:-50,rotation:0,scale:1})}\n  ${d({id:`ac-${t}-3`,left:29,top:-50,rotation:10,scale:1})}\n  </div>`,f=[{w:140,h:245,p:[[54,0],[36,35],[71,35],[18,70],[53,70],[88,70],[0,105],[35,105],[70,105],[105,105],[18,140],[53,140],[88,140],[36,175],[71,175],[54,210]]},{w:105,h:105,p:[[35,0],[35,35],[35,70],[0,35],[70,35]]},{w:175,h:175,a:!0,p:[[155,68],[145,108],[117,140],[78,154],[36,149],[2,126],[-17,88],[-17,47],[2,9],[36,-14],[78,-19],[117,-5],[145,27]]},{w:175,h:175,p:[[70,0],[35,35],[105,35],[0,70],[70,70],[140,70],[35,105],[105,105],[70,140]]},{w:140,h:140,a:!0,p:[[0,0],[35,0],[70,0],[105,0],[0,35],[105,35],[0,70],[105,70],[0,105],[35,105],[70,105],[105,105]]},{w:35,h:105,p:[[0,0],[0,35],[0,70]]},{w:175,h:175,a:!0,p:[[0,70],[35,70],[70,70],[105,70],[140,70],[70,0],[70,35],[70,105],[70,140]]},{w:105,h:105,p:[[35,35],[0,35],[70,35],[35,0],[35,70]]}],$=(o=0)=>{const{w:e,h:n,p:a,a:r=!1}=f[o];let l="";if(r){const t=i(0,1);l=`--s:${i(3,5)}s;--i:${t?"0":"359"}deg;--f:${t?"359":"0"}deg;`}return t("html").style.cssText=l,`<div class="targets${r?" a":""}" style="width:${e}px;height:${n}px;">\n  ${a.map((([t,o],e)=>((t="",o=0,e=0)=>`<div class="target" id=${t} style="left:${o}px;top:${e}px"></div>`)(`t-${e}`,t,o))).join("")}\n  </div>`};let w,v=!1;const g="hide";let u=!1;const x=[{animate:!1,angle:0,point:{x:0,y:0},score:0,arrows:0,hasArrow:!0},{animate:!1,angle:0,point:{x:0,y:0},score:0,arrows:0,hasArrow:!0}],m=[{bow:{fill:"#de8f6f",left:176,top:542,rotation:270,scale:1},arrow:{left:195,top:572,rotation:0,scale:-1}},{bow:{fill:"#3c7cab",left:176,top:40,rotation:270,scale:-1},arrow:{left:195,top:75,rotation:0,scale:1}}],y=(t,o)=>{const e=s(o),n=s(t);return{top:Math.round(e.top-n.top),left:Math.round(e.left-n.left)}},M=(t=0)=>{let o=t%360;return o<0&&(o+=360),Math.round(Math.abs(o))},b=(t,o)=>180*Math.atan2(t.y-o.y,t.x-o.x)/Math.PI,E=o=>{const{left:e,top:n}=s(t("#control"));let a=0,r=0;o instanceof MouseEvent?(a=o.clientX,r=o.clientY):o instanceof TouchEvent&&(a=o.touches[0].clientX,r=o.touches[0].clientY);return{x:Math.round(a-e),y:Math.round(r-n)}};const I=o=>{const e=t("#bow-1"),{left:n,top:r}=y(t("#control"),e),{width:l}=s(e),i={x:Math.round(n+l/2),y:r},c=b(i,o),d=M(c);if(d>=180&&d<=360){a(e,{transform:`rotate(${d}deg)`});const o=d-270;x[0].angle=o,a(t("#arrow-1"),{transform:`rotate(${o}deg)`})}},A=()=>n(t(".score"),`<span>${x[0].score}</span> - <span>${x[1].score}</span>`),B=()=>[...o(".target")].filter((t=>!r(t,g))),L=(t,o)=>t.x>=o.start.x&&t.y>=o.start.y&&t.x<=o.end.x&&t.y<=o.end.y,j=(o,e)=>{const n=t(`#arrow-${o}`),{angle:r}=x[o-1],{x:l,y:i}=function(t,o,e){const n=s(o),a=n.width,r=n.height,l=t*(1===e?1:-1)*Math.PI/180;return{x:n.left+a/2+r/2*Math.sin(l),y:n.top+(2===e?r-20:0)+r/2-r/2*Math.cos(l)}}(r,n,o),c=s(e),d={start:{x:Math.round(c.x),y:Math.round(c.y)},end:{x:Math.round(c.x+c.width),y:Math.round(c.y+c.height)}},h=L({x:l-3,y:i},d)||L({x:l,y:i},d)||L({x:l+3,y:i},d);return a(t(`#tmp-${o}`),{left:`${l}px`,top:`${i}px`}),h},D=(o=1)=>{const e=t(`#arrow-${o}`),{angle:s,point:i}=x[o-1],c=(s-90)*(Math.PI/180),d=i.x+15*Math.cos(c)*(1===o?1:-1),h=i.y+15*Math.sin(c)*(1===o?1:-1);if(x[o-1].point={x:d,y:h},a(e,{left:`${d}px`,top:`${h}px`}),p=d,(f=h)<-100||p<-50||f>832||p>462){console.log("TERMINA"),x[o-1].animate=!1,clearInterval(x[o-1].interval);const r=x[o-1].arrows>0;if(x[o-1].hasArrow=r,r){const{left:n,top:r}=m[o-1].arrow;a(e,{left:`${n}px`,top:`${r}px`}),l(t(`#ac-${o}-${x[o-1].arrows}`),g,"add"),x[o-1].arrows--,2===o&&C()}else a(t(`#bow-${o}`),{transform:`rotate(${m[o-1].bow.rotation}deg)`});(()=>{const o=x.findIndex((t=>t.score>=70));if(o>=0){S(),u=!0;const e=t(".win-ui"),a=0===o?"r":"b";n(e,`<span>${0===o?"RED":"BLUE"} WIN</span>`),l(e,g,"remove"),l(e,a,"add")}else{const t=B(),o=0!==x.filter((t=>t.hasArrow)).length;0!==t.length&&o||(S(),G())}})()}else(t=>{const o=B();for(const e of o){const o=e;j(t,o)&&!r(o,g)&&(l(o,g,"add"),x[t-1].score++,A())}})(o);var p,f},T=(t=1)=>{const{left:o,top:e}=m[t-1].arrow;x[t-1].point={x:o,y:e},x[t-1].animate=!0,x[t-1].interval=setInterval((()=>D(t)),1)},k=t=>{u||v||x[0].animate||!x[0].hasArrow||(I(E(t)),v=!0,console.log("handleMouseDown"))},O=()=>{u||!v||x[0].animate||(T(),console.log("handleMouseUp"),v=!1)},R=t=>{u||!v||x[0].animate||I(E(t))},S=()=>{w&&clearInterval(w);for(let t=0;t<x.length;t++)x[t].interval&&clearInterval(x[t].interval)},C=()=>{let o=B();if(0===o.length)return;let e=i(0,o.length-1),n=o[e];const l={x:m[1].bow.left,y:m[1].bow.top};let s=0;w=setInterval((()=>{const{left:c,top:d}=y(t(".game"),n),h=M(b(l,{x:c,y:d}));a(t("#bow-2"),{transform:`rotate(${h}deg)`});const p=h-270;if(x[1].angle=p,a(t("#arrow-2"),{transform:`rotate(${p}deg)`}),s++,s%10==0){console.log({counterToShoot:s});let t=!0;r(n,g)&&(o=B(),console.log("DEBE BUSCAR OTRO BLANCO"),0!==o.length&&(e=i(0,o.length-1),n=o[e],t=!1)),t&&(clearInterval(w),T(2))}}),100)},G=()=>{const o=i(0,f.length-1);n(t("#r-target"),$(o)),m.forEach((({arrow:o,bow:e},n)=>{a(t(`#bow-${n+1}`),{transform:`rotate(${e.rotation}deg)`}),a(t(`#arrow-${n+1}`),{left:`${o.left}px`,top:`${o.top}px`,transform:`rotate(${o.rotation}deg)`,display:"block"})}));for(let o=0;o<x.length;o++){x[o].animate=!1,x[o].arrows=2,x[o].hasArrow=!0,x[o].interval&&clearInterval(x[o].interval);for(let e=1;e<=3;e++)l(t(`#ac-${o+1}-${e}`),g,3===e?"add":"remove")}C()},N={Game:()=>{const o=`<div class="game wh jc">\n      <div class="lock-ui wh jc"></div>\n      <div class="win-ui hide wh jc"></div>\n      ${m.map(((t,o)=>`${h(Object.assign({id:`bow-${o+1}`},t.bow))}\n          ${d(Object.assign({id:`arrow-${o+1}`},t.arrow))}\n          ${p({index:o+1,type:0===o?"bottom":"top"})}\n        `)).join("")}\n      <div class="score jc"></div>\n      <button id="exit">EXIT</button>\n      <div id="r-target"></div>\n      <div id="control"></div>\n  </div>`;n(t(`#${c}`),o),(()=>{[["mousedown",k],["mouseup",O],["mousemove",R],["touchstart",k],["touchend",O],["touchmove",R],["mouseleave",O]].forEach((o=>e(t("#control"),o[0],o[1]))),e(t("#exit"),"click",(()=>{S(),console.log("IR A LA P√ÅGINA DEL LOBBY")})),A(),u=!1;for(let t=0;t<x.length;t++)x[t].score=0;let o=1;const a=setInterval((()=>{n(t(".lock-ui"),String(o)),o--,o<0&&(l(t(".lock-ui"),g,"add"),clearInterval(a),G())}),1e3)})()}},P=(t="Game",o={})=>{N[t](o)};n(t("#root"),`<div\n    id="${c}"\n    style="overflow: hidden;width:412px;height:732px"\n  ></div>`),e(document,"contextmenu",(t=>t.preventDefault())),P("Game")})();